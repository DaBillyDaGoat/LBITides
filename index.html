<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LBI Tides â€” Long Beach Island</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Permanent+Marker&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --sunset1: #f4a32a;
    --sunset2: #e8682a;
    --sunset3: #c94b2a;
    --sand:    #e8d9b8;
    --sand2:   #ede0b8;
    --ocean:   #1a5276;
    --ocean2:  #0e3a52;
    --foam:    #d4e8f0;
    --text:    #1a1a1a;
    --text2:   #2c3e50;
    --label:   #1a3a4a;
    --muted:   #5a6a5a;
    --card:    #0e3a52;
    --border:  rgba(255,255,255,0.12);

}

- { margin:0; padding:0; box-sizing:border-box; }

body {
font-family: â€˜Latoâ€™, sans-serif;
background: var(â€“sand);
color: var(â€“text);
min-height: 100vh;
overflow-x: hidden;
position: relative;
}

/* â”€â”€ STORM BANNER â”€â”€ */
#stormBanner {
display:none; position:sticky; top:0; z-index:200;
padding:0.85rem 3rem 0.85rem 1.25rem;
font-family:â€˜Latoâ€™,sans-serif; font-size:0.9rem; font-weight:900;
letter-spacing:0.08em; text-align:center; color:#fff;
background: #c0392b;
box-shadow:0 4px 20px rgba(0,0,0,0.5);
text-transform: uppercase;
text-shadow: 0 1px 3px rgba(0,0,0,0.4);
}
#stormBanner.watch    { background: #d35400; }
#stormBanner.advisory { background: #b7770d; color:#fff; }
.banner-close { position:absolute; right:1rem; top:50%; transform:translateY(-50%); cursor:pointer; background:none; border:none; color:inherit; font-size:1.2rem; opacity:0.75; }

/* â”€â”€ HEADER â”€â”€ */
header {
position: relative;
background: linear-gradient(175deg, var(â€“ocean2) 0%, #1a5276 40%, #2471a3 70%, #e8682a 100%);
padding: 2.5rem 1.5rem 6rem;
text-align: center;
overflow: hidden;
}

/* Sun glow behind lighthouse */
header::before {
content: â€˜â€™;
position: absolute;
top: 30%; left: 50%; transform: translate(-50%, -50%);
width: 200px; height: 200px;
background: radial-gradient(circle, rgba(244,163,42,0.35) 0%, transparent 70%);
pointer-events: none;
}

header::after {
content:â€™â€™; position:absolute; bottom:0; left:0; right:0; height:80px;
background: var(â€“sand);
clip-path: ellipse(60% 100% at 50% 100%);
}

/* â”€â”€ OLD BARNEY PHOTO BADGE â”€â”€ */
.logo-wrap { position:relative; z-index:2; display:inline-block; margin-bottom:1.25rem; }

.photo-badge {
width: 130px; height: 130px;
border-radius: 50%;
border: 4px solid var(â€“sunset1);
box-shadow: 0 0 0 8px rgba(244,163,42,0.2), 0 6px 30px rgba(0,0,0,0.5);
overflow: hidden;
margin: 0 auto;
position: relative;
}

.photo-badge img {
width: 100%; height: 100%;
object-fit: cover;
object-position: center 30%;
filter: saturate(1.15) contrast(1.05);
}

/* Vintage film frame inside badge */
.photo-badge::after {
content: â€˜â€™;
position: absolute; inset: 0;
border-radius: 50%;
box-shadow: inset 0 0 20px rgba(0,0,0,0.3), inset 0 0 0 2px rgba(244,163,42,0.4);
}

.badge-label {
font-family: â€˜Latoâ€™, sans-serif;
font-size: 0.6rem; font-weight: 700;
letter-spacing: 0.28em; text-transform: uppercase;
color: var(â€“sunset1); margin-top: 0.6rem;
}

/* â”€â”€ SITE TITLE â”€â”€ */
.site-title {
font-family: â€˜Abril Fatfaceâ€™, serif;
font-size: clamp(2.8rem, 8vw, 4.5rem);
color: #fff;
line-height: 1;
position: relative; z-index: 2;
text-shadow: 3px 3px 0 rgba(0,0,0,0.2), 0 4px 20px rgba(0,0,0,0.3);
letter-spacing: 0.02em;
}

.site-sub {
font-family: â€˜Latoâ€™, sans-serif;
font-size: 0.75rem; font-weight: 700;
letter-spacing: 0.3em; text-transform: uppercase;
color: var(â€“sunset1); margin-top: 0.3rem;
position: relative; z-index: 2;
}

#current-date {
font-family: â€˜Latoâ€™, sans-serif;
font-size: 0.75rem; font-weight: 400;
letter-spacing: 0.15em; text-transform: uppercase;
color: rgba(255,255,255,0.7); margin-top: 0.5rem;
position: relative; z-index: 2;
}

/* â”€â”€ MAIN â”€â”€ */
main {
background: var(â€“sand);
padding: 1.75rem 1rem 4rem;
max-width: 860px; margin: 0 auto;
}

/* â”€â”€ AD â”€â”€ */
.ad-unit, .ad-divider {
background: rgba(14,58,82,0.15);
border: 1.5px dashed rgba(26,82,118,0.2);
border-radius: 8px;
text-align: center; color: var(â€“muted);
font-size: 0.65rem; font-weight: 700;
letter-spacing: 0.16em; text-transform: uppercase;
display: flex; align-items: center; justify-content: center;
}
.ad-unit.leaderboard { height: 90px; margin-bottom: 1.5rem; }
.ad-divider { min-height: 100px; margin: 1.5rem 0; }

/* â”€â”€ CARDS â”€â”€ */
.card {
background: var(â€“card);
border-radius: 12px;
padding: 1.25rem;
margin-bottom: 1rem;
box-shadow: 2px 3px 0 rgba(26,82,118,0.08), 0 6px 20px rgba(0,0,0,0.07);
border: 1px solid var(â€“border);
}

.card-title {
font-family: â€˜Abril Fatfaceâ€™, serif;
font-size: 1rem; color: #fff;
margin-bottom: 1rem;
display: flex; align-items: center; gap: 0.45rem;
border-bottom: 2px solid rgba(255,255,255,0.15);
padding-bottom: 0.6rem;
letter-spacing: 0.02em;
}

/* â”€â”€ SUMMARY â”€â”€ */
.summary-box {
background: linear-gradient(135deg, var(â€“ocean2) 0%, #1a5276 100%);
border-radius: 12px; padding: 1.25rem 1.4rem;
color: #fff; margin-bottom: 1rem;
box-shadow: 3px 4px 0 rgba(0,0,0,0.15), 0 8px 24px rgba(26,82,118,0.25);
border: 1px solid rgba(255,255,255,0.08);
position: relative; overflow: hidden;
}
.summary-box::before {
content:â€™â€™; position:absolute; top:-30px; right:-30px;
width:120px; height:120px; border-radius:50%;
background: radial-gradient(circle, rgba(244,163,42,0.2) 0%, transparent 70%);
}
.summary-box .s-label {
font-size:0.62rem; letter-spacing:0.22em; text-transform:uppercase;
color: var(â€“sunset1); font-weight:700; margin-bottom:0.4rem;
}
.summary-box .s-text {
font-family: â€˜Abril Fatfaceâ€™, serif;
font-size: 0.95rem; line-height: 1.65; color: #f0f8ff;
font-weight: 400;
}
.summary-tags { display:flex; flex-wrap:wrap; gap:0.35rem; margin-top:0.75rem; }
.tag {
background: rgba(244,163,42,0.2); border: 1px solid rgba(244,163,42,0.4);
border-radius: 999px; padding:0.2rem 0.65rem;
font-size:0.66rem; font-weight:700; color: var(â€“sunset1);
letter-spacing: 0.05em; text-transform: uppercase;
}

/* â”€â”€ TIDE PILLS â”€â”€ */
.tide-pills { display:flex; flex-wrap:wrap; gap:0.65rem; margin-bottom:1rem; }
.tide-pill {
flex:1; min-width:110px; background: var(â€“ocean2);
color:#fff; border-radius:10px; padding:0.85rem 0.9rem; text-align:center;
box-shadow: 2px 3px 0 rgba(0,0,0,0.12);
}
.tide-pill.low { background: #1a6e8a; }
.tide-pill .tp-label { font-size:0.6rem; letter-spacing:0.16em; text-transform:uppercase; color: var(â€“sunset1); font-weight:700; margin-bottom:0.2rem; }
.tide-pill .tp-time { font-family:â€˜Abril Fatfaceâ€™,serif; font-size:1.3rem; color:#fff; }
.tide-pill .tp-height { font-size:0.72rem; color:#b8d4e8; margin-top:0.1rem; font-weight:700; }

/* â”€â”€ TIDE TIMELINE â”€â”€ */
.tide-timeline { margin: 0.75rem 0 0.5rem; }
.timeline-bar {
position: relative;
height: 48px;
background: rgba(255,255,255,0.08);
border-radius: 999px;
margin-bottom: 0.5rem;
overflow: visible;
}
.timeline-track {
position: absolute; top: 50%; left: 0; right: 0;
height: 3px; background: rgba(255,255,255,0.25);
transform: translateY(-50%); border-radius:999px;
}
.timeline-marker {
position: absolute; top: 50%; transform: translate(-50%, -50%);
display: flex; flex-direction: column; align-items: center;
z-index: 2;
}
.timeline-marker .tm-dot {
width: 14px; height: 14px; border-radius: 50%;
border: 2px solid #fff;
box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}
.timeline-marker.high .tm-dot { background: var(â€“ocean2); }
.timeline-marker.low  .tm-dot { background: #2471a3; }
.timeline-marker .tm-label {
font-size: 0.58rem; font-weight: 700; letter-spacing: 0.05em;
color: #fff; white-space: nowrap; margin-top: 3px;
text-transform: uppercase;
}
.timeline-marker.above .tm-label { margin-top: 0; margin-bottom: 3px; order: -1; }
.timeline-hour-labels {
display: flex; justify-content: space-between;
font-size: 0.6rem; color: #a8d4ee; font-weight: 700;
letter-spacing: 0.04em; margin-top: 0.2rem;
padding: 0 0.25rem;
}

/* â”€â”€ STATS GRID â”€â”€ */
.stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:0.65rem; }
.stat-block {
background: var(â€“ocean2); border:1px solid rgba(255,255,255,0.08);
border-radius:10px; padding:0.85rem 0.7rem; text-align:center;
box-shadow: 2px 3px 0 rgba(0,0,0,0.15);
}
.stat-block .sb-icon { font-size:1.3rem; margin-bottom:0.2rem; }
.stat-block .sb-label { font-size:0.58rem; letter-spacing:0.16em; text-transform:uppercase; color:var(â€“sunset1); font-weight:700; margin-bottom:0.15rem; }
.stat-block .sb-value { font-family:â€˜Abril Fatfaceâ€™,serif; font-size:1.25rem; color:#fff; }
.stat-block .sb-unit { font-size:0.62rem; color:#b8d4e8; font-weight:700; }

/* â”€â”€ MOON â”€â”€ */
.moon-row { display:flex; align-items:center; gap:1.25rem; flex-wrap:wrap; }
.moon-em { font-size:3.2rem; line-height:1; }
.moon-info { min-width:130px; }
.moon-info .m-phase { font-family:â€˜Abril Fatfaceâ€™,serif; font-size:1.1rem; color:#fff; }
.moon-info .m-detail { font-size:0.78rem; color:#a8d4ee; font-weight:700; margin-top:0.15rem; letter-spacing:0.04em; }
.moon-bar-wrap { flex:1; min-width:160px; }
.moon-bar-lbl { font-size:0.58rem; letter-spacing:0.16em; text-transform:uppercase; color:var(â€“sunset1); font-weight:700; margin-bottom:0.35rem; }
.moon-bar { height:8px; background:rgba(255,255,255,0.15); border-radius:999px; overflow:hidden; }
.moon-bar-fill { height:100%; background:linear-gradient(90deg,var(â€“sunset1),#ffd24d); border-radius:999px; }
.moon-day-label { font-size:0.62rem; color:#a8d4ee; font-weight:700; margin-top:0.3rem; text-align:right; letter-spacing:0.04em; }

/* â”€â”€ SECTION HEADING â”€â”€ */
.section-heading {
font-family: â€˜Abril Fatfaceâ€™, serif;
font-size: 1.6rem; color: var(â€“ocean2);
margin: 2rem 0 1rem;
padding-bottom: 0.5rem;
border-bottom: 3px solid var(â€“ocean2);
display: flex; align-items: center; gap: 0.5rem;
letter-spacing: 0.01em;
}

/* â”€â”€ DAY CARDS â”€â”€ */
.day-card {
background: var(â€“card); border-radius:12px;
padding:1.1rem 1.25rem 1.25rem; margin-bottom:0.85rem;
border:1px solid rgba(255,255,255,0.12);
box-shadow: 2px 3px 0 rgba(26,82,118,0.07), 0 4px 12px rgba(0,0,0,0.05);
}
.day-card.today-card { border-color: var(â€“ocean2); border-width:2px; }

.day-header { display:flex; align-items:baseline; justify-content:space-between; margin-bottom:0.85rem; }
.day-name-big { font-family:â€˜Abril Fatfaceâ€™,serif; font-size:1.15rem; color:#fff; }
.day-date-small { font-size:0.7rem; color:#a8d4ee; font-weight:700; letter-spacing:0.06em; text-transform:uppercase; }

.day-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(95px,1fr)); gap:0.5rem; margin-bottom:0.65rem; }
.day-stat {
background: var(â€“ocean2); border:1px solid rgba(255,255,255,0.08);
border-radius:9px; padding:0.55rem 0.5rem; text-align:center;
box-shadow: 1px 2px 0 rgba(0,0,0,0.12);
}
.day-stat .ds-lbl { font-size:0.54rem; letter-spacing:0.15em; text-transform:uppercase; color:var(â€“sunset1); font-weight:700; margin-bottom:0.12rem; }
.day-stat .ds-val { font-family:â€˜Abril Fatfaceâ€™,serif; font-size:1rem; color:#fff; }
.day-stat .ds-unit { font-size:0.58rem; color:#b8d4e8; font-weight:700; }

.day-tides { display:flex; flex-wrap:wrap; gap:0.4rem; margin-top:0.5rem; }
.mini-pill {
flex:1; min-width:85px; background:var(â€“ocean2);
color:#fff; border-radius:8px; padding:0.5rem 0.6rem; text-align:center;
box-shadow: 1px 2px 0 rgba(0,0,0,0.1);
}
.mini-pill.low { background: #1a6e8a; }
.mini-pill .mp-lbl { font-size:0.54rem; letter-spacing:0.14em; text-transform:uppercase; color:var(â€“sunset1); font-weight:700; }
.mini-pill .mp-time { font-family:â€˜Abril Fatfaceâ€™,serif; font-size:1rem; }
.mini-pill .mp-ht { font-size:0.6rem; color:#b8d4e8; font-weight:700; }

/* â”€â”€ LBI LINKS â”€â”€ */
.aff-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:0.75rem; }
.aff-item {
background: var(â€“ocean2); border-radius:10px; padding:1rem 0.75rem;
text-align:center; text-decoration:none; color:#fff;
box-shadow: 2px 3px 0 rgba(0,0,0,0.15);
transition: transform 0.15s, box-shadow 0.15s;
}
.aff-item:hover { transform:translateY(-2px); box-shadow:3px 5px 0 rgba(0,0,0,0.2); }
.aff-item .aff-icon { font-size:1.8rem; margin-bottom:0.35rem; }
.aff-item .aff-label { font-family:â€˜Abril Fatfaceâ€™,serif; font-size:0.85rem; color:#fff; }
.aff-item .aff-sub { font-size:0.65rem; color:#a8d4ee; font-weight:700; margin-top:0.2rem; letter-spacing:0.04em; }

/* â”€â”€ FOOTER â”€â”€ */
footer {
background: var(â€“ocean2); color: rgba(255,255,255,0.5);
text-align:center; padding:2rem 1rem;
font-size:0.72rem; letter-spacing:0.08em; line-height:2;
font-weight: 400;
}
footer a { color:rgba(255,255,255,0.6); text-decoration:none; }

/* â”€â”€ FADE IN â”€â”€ */
.fade-in { opacity:0; transform:translateY(10px); transition:opacity 0.5s ease,transform 0.5s ease; }
.fade-in.visible { opacity:1; transform:translateY(0); }
</style>

</head>
<body>

<!-- STORM BANNER -->

<div id="stormBanner">
  <span id="bannerText"></span>
  <button class="banner-close" onclick="this.parentElement.style.display='none'">âœ•</button>
</div>

<!-- HEADER -->

<header>
  <div class="logo-wrap">
    <div class="photo-badge">
      <img src="barney.jpg" alt="Old Barney â€” Barnegat Lighthouse">
    </div>
    <div class="badge-label">Est. 2026</div>
  </div>
  <div class="site-title">LBI Tides</div>
  <div class="site-sub">Long Beach Island, New Jersey</div>
  <div id="current-date">â€”</div>
</header>

<main>

  <div class="ad-unit leaderboard"><!-- AdSense 728Ã—90 -->Advertisement</div>

  <!-- SUMMARY -->

  <div class="summary-box fade-in">
    <div class="s-label">Today at a Glance</div>
    <div class="s-text" id="summaryText">Loading today's conditions...</div>
    <div class="summary-tags" id="summaryTags"></div>
  </div>

  <!-- TIDES -->

  <div class="card fade-in">
    <div class="card-title">ğŸŒŠ Today's Tides</div>
    <div class="tide-pills" id="tidePills"><div style="color:var(--muted);font-size:.85rem">Loading...</div></div>
    <div class="tide-timeline" id="tideTimeline"></div>
  </div>

  <!-- WEATHER -->

  <div class="card fade-in">
    <div class="card-title">â˜€ï¸ Weather & Ocean</div>
    <div class="stats-grid" id="weatherStats"><div style="color:var(--muted);font-size:.85rem">Loading...</div></div>
  </div>

  <!-- MOON -->

  <div class="card fade-in">
    <div class="card-title">ğŸŒ™ Moon Phase</div>
    <div class="moon-row" id="moonDisplay"><div style="color:var(--muted);font-size:.85rem">Loading...</div></div>
  </div>

  <!-- LBI LINKS -->

  <div class="card fade-in">
    <div class="card-title">ğŸï¸ LBI Essentials</div>
    <div class="aff-grid">
      <a href="https://www.thesandpaper.net" class="aff-item" target="_blank">
        <div class="aff-icon">ğŸ“°</div>
        <div class="aff-label">The Sand Paper</div>
        <div class="aff-sub">Local LBI news</div>
      </a>
      <a href="https://ferrarasislandbakery.com" class="aff-item" target="_blank">
        <div class="aff-icon">ğŸ©</div>
        <div class="aff-label">Ferrara's Bakery</div>
        <div class="aff-sub">Island baked goods</div>
      </a>
      <a href="https://fantasyislandlbi.com" class="aff-item" target="_blank">
        <div class="aff-icon">ğŸ¡</div>
        <div class="aff-label">Fantasy Island</div>
        <div class="aff-sub">Rides & amusements</div>
      </a>
      <a href="https://www.longbeachtownship.com" class="aff-item" target="_blank">
        <div class="aff-icon">ğŸ›Ÿ</div>
        <div class="aff-label">LB Township</div>
        <div class="aff-sub">Town info & resources</div>
      </a>
    </div>
  </div>

  <div class="section-heading fade-in">ğŸ“… 7-Day Forecast</div>
  <div id="forecastDays"></div>

</main>

<footer>
  <p>Data: NOAA Tides &amp; Currents Â· Open-Meteo Weather &amp; Marine Â· NWS Alerts</p>
  <p>Updated automatically each visit</p>
  <p style="margin-top:.25rem"><a href="#">Privacy Policy</a> Â· <a href="#">Contact</a> Â· Â© 2025 LBITides.com</p>
</footer>

<script>
const STATION='8534720', LAT=39.6515, LNG=-74.1945, TZ='America/New_York';

const fmtDate = d => d.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'});
const fmtFullDay = s => new Date(s+'T12:00:00').toLocaleDateString('en-US',{weekday:'long'});
const fmtShortDate = s => new Date(s+'T12:00:00').toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
const fmtTime = s => new Date(s.replace(' ','T')).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});
const compass = d => ['N','NE','E','SE','S','SW','W','NW'][Math.round(d/45)%8];
const moonEmoji = p=>{if(p<0.03||p>0.97)return'ğŸŒ‘';if(p<0.22)return'ğŸŒ’';if(p<0.28)return'ğŸŒ“';if(p<0.47)return'ğŸŒ”';if(p<0.53)return'ğŸŒ•';if(p<0.72)return'ğŸŒ–';if(p<0.78)return'ğŸŒ—';return'ğŸŒ˜';};
const moonName = p=>{if(p<0.03||p>0.97)return'New Moon';if(p<0.22)return'Waxing Crescent';if(p<0.28)return'First Quarter';if(p<0.47)return'Waxing Gibbous';if(p<0.53)return'Full Moon';if(p<0.72)return'Waning Gibbous';if(p<0.78)return'Last Quarter';return'Waning Crescent';};
const moonPhase = date=>{const k=new Date('2024-01-11T11:57:00Z'),c=29.53058770576;return(((date-k)/86400000%c)+c)%c/c;};
const noaaDate = (o=0)=>{const d=new Date();d.setDate(d.getDate()+o);return d.toISOString().slice(0,10).replace(/-/g,'');};
const isoDate = (o=0)=>{const d=new Date();d.setDate(d.getDate()+o);return d.toISOString().slice(0,10);};

document.getElementById('current-date').textContent = fmtDate(new Date());

// STORM ALERTS
async function loadAlerts(){
  try{
    const r=await fetch(`https://api.weather.gov/alerts/active?point=${LAT},${LNG}&status=actual`);
    const d=await r.json();
    const kw=['winter storm','winter weather','blizzard','hurricane','tropical storm','flash flood','coastal flood','high wind','tornado','freeze','ice storm','nor\'easter','special marine','small craft','gale','storm warning','dense fog','heavy snow'];
    const hits=(d.features||[]).filter(a=>kw.some(k=>(a.properties.event||'').toLowerCase().includes(k)));
    if(!hits.length)return;
    const p=hits[0].properties, ev=(p.event||'').toLowerCase();
    const b=document.getElementById('stormBanner');
    b.style.display='block';
    if(ev.includes('warning')||p.severity==='extreme')b.className='warning';
    else if(ev.includes('watch'))b.className='watch';
    else b.className='advisory';
    document.getElementById('bannerText').textContent=`âš ï¸ ${p.event}: ${p.headline||p.description?.slice(0,110)||'Active alert for LBI'}`;
  }catch(e){}
}

// TIDES
async function loadTides(){
  const today=noaaDate(0),end=noaaDate(6);
  try{
    const [h]=await Promise.all([
      fetch(`https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?begin_date=${today}&end_date=${end}&station=${STATION}&product=predictions&datum=MLLW&time_zone=lst_ldt&interval=hilo&units=english&application=lbitides&format=json`).then(r=>r.json())
    ]);
    const all=h.predictions||[];
    const byDate={};
    all.forEach(p=>{const d=p.t.slice(0,10);(byDate[d]=byDate[d]||[]).push(p);});
    return {byDate};
  }catch(e){return{byDate:{}};}
}

function renderTodayTides(preds){
  document.getElementById('tidePills').innerHTML=preds.length
    ?preds.map(p=>`<div class="tide-pill ${p.type==='L'?'low':''}"><div class="tp-label">${p.type==='H'?'â–² High':'â–½ Low'}</div><div class="tp-time">${fmtTime(p.t)}</div><div class="tp-height">${parseFloat(p.v).toFixed(1)} ft</div></div>`).join('')
    :'<p style="color:var(--muted)">No data</p>';
}

function renderTideTimeline(preds){
  if(!preds.length){document.getElementById('tideTimeline').innerHTML='';return;}
  const container=document.getElementById('tideTimeline');
  // Build a clean horizontal timeline showing each tide event as a dot at the right time position
  const markers=preds.map((p,i)=>{
    const d=new Date(p.t.replace(' ','T'));
    const hrs=d.getHours()+d.getMinutes()/60;
    const pct=(hrs/24)*100;
    const isHigh=p.type==='H';
    const above=i%2===0;
    return `<div class="timeline-marker ${isHigh?'high':'low'} ${above?'above':''}" style="left:${pct}%">
      ${above?`<div class="tm-label">${fmtTime(p.t)}<br>${parseFloat(p.v).toFixed(1)}ft</div>`:''}
      <div class="tm-dot"></div>
      ${!above?`<div class="tm-label">${fmtTime(p.t)}<br>${parseFloat(p.v).toFixed(1)}ft</div>`:''}
    </div>`;
  }).join('');

  container.innerHTML=`
    <div class="tide-timeline">
      <div class="timeline-bar">
        <div class="timeline-track"></div>
        ${markers}
      </div>
      <div class="timeline-hour-labels">
        <span>12am</span><span>6am</span><span>12pm</span><span>6pm</span><span>11pm</span>
      </div>
    </div>`;
}

// WEATHER
async function loadWeather(){
  try{
    const [w,m]=await Promise.all([
      fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LNG}&current=temperature_2m,apparent_temperature,wind_speed_10m,wind_direction_10m,uv_index&daily=temperature_2m_max,temperature_2m_min,wind_speed_10m_max&timezone=${TZ}&forecast_days=7&temperature_unit=fahrenheit&wind_speed_unit=mph`).then(r=>r.json()),
      fetch(`https://marine-api.open-meteo.com/v1/marine?latitude=${LAT}&longitude=${LNG}&current=wave_height,wave_direction,wave_period,sea_surface_temperature&daily=wave_height_max,wave_period_max,sea_surface_temperature_max&timezone=${TZ}&forecast_days=7`).then(r=>r.json())
    ]);
    return{w,m};
  }catch(e){return null;}
}

function renderTodayWeather(w,m){
  const c=w.current,mc=m.current;
  const wh=mc?.wave_height!=null?(mc.wave_height*3.281).toFixed(1):'--';
  const wp=mc?.wave_period!=null?mc.wave_period.toFixed(0):'--';
  const wt=mc?.sea_surface_temperature!=null?(mc.sea_surface_temperature*9/5+32).toFixed(0):'--';
  document.getElementById('weatherStats').innerHTML=`
    <div class="stat-block"><div class="sb-icon">ğŸŒ¡ï¸</div><div class="sb-label">Air Temp</div><div class="sb-value">${c.temperature_2m?.toFixed(0)||'--'}<span class="sb-unit">Â°F</span></div></div>
    <div class="stat-block"><div class="sb-icon">ğŸ’§</div><div class="sb-label">Water Temp</div><div class="sb-value">${wt}<span class="sb-unit">Â°F</span></div></div>
    <div class="stat-block"><div class="sb-icon">ğŸŒŠ</div><div class="sb-label">Wave Height</div><div class="sb-value">${wh}<span class="sb-unit">ft</span></div></div>
    <div class="stat-block"><div class="sb-icon">â±ï¸</div><div class="sb-label">Wave Period</div><div class="sb-value">${wp}<span class="sb-unit">s</span></div></div>
    <div class="stat-block"><div class="sb-icon">ğŸ’¨</div><div class="sb-label">Wind</div><div class="sb-value">${c.wind_speed_10m?.toFixed(0)||'--'}<span class="sb-unit">mph ${compass(c.wind_direction_10m||0)}</span></div></div>
    <div class="stat-block"><div class="sb-icon">â˜€ï¸</div><div class="sb-label">UV Index</div><div class="sb-value">${c.uv_index?.toFixed(0)||'--'}</div></div>`;
}

// MOON
function renderMoon(){
  const phase=moonPhase(new Date()),pct=Math.round(phase*100);
  const illum=phase<0.5?Math.round(phase*2*100):Math.round((1-phase)*2*100);
  document.getElementById('moonDisplay').innerHTML=`
    <div class="moon-em">${moonEmoji(phase)}</div>
    <div class="moon-info"><div class="m-phase">${moonName(phase)}</div><div class="m-detail">${illum}% illuminated</div></div>
    <div class="moon-bar-wrap">
      <div class="moon-bar-lbl">Lunar Cycle</div>
      <div class="moon-bar"><div class="moon-bar-fill" style="width:${pct}%"></div></div>
      <div class="moon-day-label">Day ${Math.round(phase*29.5)} of 29.5</div>
    </div>`;
  return phase;
}

// SUMMARY
function buildSummary(todayTides,wData,mData,phase){
  const parts=[],tags=[];
  if(todayTides?.length){const f=todayTides[0];parts.push(`${f.type==='H'?'High':'Low'} tide at ${fmtTime(f.t)}`);}
  const mc=mData?.current;
  if(mc?.wave_height!=null){const wh=(mc.wave_height*3.281).toFixed(1),wf=parseFloat(wh);
    if(wf<1){parts.push('glassy flat conditions');tags.push('Calm Water');}
    else if(wf<2){parts.push(`${wh}ft â€” gentle surf`);tags.push('Easy Surf');}
    else if(wf<4){parts.push(`${wh}ft waves`);tags.push('Good Surf');}
    else{parts.push(`${wh}ft â€” solid swell`);tags.push('Big Surf');}
  }
  const wc=wData?.current;
  if(wc?.wind_speed_10m!=null){const ws=wc.wind_speed_10m;if(ws<10)tags.push('Light Winds');else if(ws<20)tags.push('Moderate Winds');else tags.push('Windy');}
  const mn=moonName(phase);
  if(mn==='Full Moon'||mn==='New Moon'){parts.push(`${mn} â€” expect stronger tides`);tags.push('Strong Tides');tags.push('Good Fishing');}
  if(wc?.uv_index>=8)tags.push('High UV â˜€ï¸');else if(wc?.uv_index>=5)tags.push('Moderate UV');
  if(!parts.length)parts.push('Check conditions below for Long Beach Island');
  if(!tags.length)tags.push('LBI','Tides','Beach');
  document.getElementById('summaryText').textContent=parts.join(' Â· ')+'.';
  document.getElementById('summaryTags').innerHTML=tags.map(t=>`<span class="tag">${t}</span>`).join('');
}

// 7-DAY
function buildForecastDays(byDate,w,m){
  const dates=Object.keys(byDate).sort().slice(0,7);
  const wd=w.daily,md=m.daily;
  let html='';
  dates.forEach((dateStr,i)=>{
    const isToday=i===0,tides=byDate[dateStr]||[];
    const phase=moonPhase(new Date(dateStr+'T12:00:00'));
    const hi=wd?.temperature_2m_max?.[i]!=null?wd.temperature_2m_max[i].toFixed(0)+'Â°F':'--';
    const lo=wd?.temperature_2m_min?.[i]!=null?wd.temperature_2m_min[i].toFixed(0)+'Â°F':'--';
    const wh=md?.wave_height_max?.[i]!=null?(md.wave_height_max[i]*3.281).toFixed(1)+'ft':'--';
    const wp=md?.wave_period_max?.[i]!=null?md.wave_period_max[i].toFixed(0)+'s':'--';
    const wt=md?.sea_surface_temperature_max?.[i]!=null?(md.sea_surface_temperature_max[i]*9/5+32).toFixed(0)+'Â°F':'--';
    const wind=wd?.wind_speed_10m_max?.[i]!=null?wd.wind_speed_10m_max[i].toFixed(0)+'mph':'--';
    if(i===3)html+=`<div class="ad-divider"><!-- AdSense mid-scroll 320Ã—100 -->Advertisement</div>`;
    html+=`<div class="day-card ${isToday?'today-card':''} fade-in">
      <div class="day-header">
        <div class="day-name-big">${isToday?'Today':fmtFullDay(dateStr)}</div>
        <div class="day-date-small">${fmtShortDate(dateStr)}</div>
      </div>
      <div class="day-grid">
        <div class="day-stat"><div class="ds-lbl">High</div><div class="ds-val">${hi}</div></div>
        <div class="day-stat"><div class="ds-lbl">Low</div><div class="ds-val">${lo}</div></div>
        <div class="day-stat"><div class="ds-lbl">Waves</div><div class="ds-val">${wh}</div></div>
        <div class="day-stat"><div class="ds-lbl">Period</div><div class="ds-val">${wp}</div></div>
        <div class="day-stat"><div class="ds-lbl">Water</div><div class="ds-val">${wt}</div></div>
        <div class="day-stat"><div class="ds-lbl">Wind</div><div class="ds-val">${wind}</div></div>
        <div class="day-stat"><div class="ds-lbl">Moon</div><div class="ds-val" style="font-size:1.3rem;line-height:1.1">${moonEmoji(phase)}</div><div class="ds-unit">${moonName(phase).replace(' Moon','')}</div></div>
      </div>
      <div class="day-tides">${tides.map(p=>`<div class="mini-pill ${p.type==='L'?'low':''}"><div class="mp-lbl">${p.type==='H'?'â–² High':'â–½ Low'}</div><div class="mp-time">${fmtTime(p.t)}</div><div class="mp-ht">${parseFloat(p.v).toFixed(1)}ft</div></div>`).join('')}</div>
    </div>`;
  });
  html+=`<div class="ad-divider" style="margin-bottom:0"><!-- AdSense post-forecast 320Ã—100 -->Advertisement</div>`;
  document.getElementById('forecastDays').innerHTML=html;
  document.querySelectorAll('.fade-in:not(.visible)').forEach(el=>observer.observe(el));
}

const observer=new IntersectionObserver(entries=>{entries.forEach(e=>{if(e.isIntersecting)e.target.classList.add('visible');});},{threshold:0.08});
document.querySelectorAll('.fade-in').forEach(el=>observer.observe(el));

async function init(){
  const [tideData,weatherData]=await Promise.all([loadTides(),loadWeather()]);
  const todayStr=new Date().toISOString().slice(0,10);
  const todayTides=tideData.byDate[todayStr]||[];
  renderTodayTides(todayTides);
  renderTideTimeline(todayTides);
  if(weatherData)renderTodayWeather(weatherData.w,weatherData.m);
  const phase=renderMoon();
  buildSummary(todayTides,weatherData?.w,weatherData?.m,phase);
  if(weatherData&&Object.keys(tideData.byDate).length)buildForecastDays(tideData.byDate,weatherData.w,weatherData.m);
  loadAlerts();
}

init();
</script>

</body>
</html>
